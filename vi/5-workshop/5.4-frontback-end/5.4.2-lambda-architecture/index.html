<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=https://nguyenduyson2005.github.io/fcj-report/images/favicon.png type=image/png><title>Kiến trúc Lambda :: Báo cáo thực tập</title>
<link href=https://nguyenduyson2005.github.io/fcj-report/css/nucleus.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/fontawesome-all.min.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/hybrid.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/featherlight.min.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/perfect-scrollbar.min.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/auto-complete.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/atom-one-dark-reasonable.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/theme.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/hugo-theme.css?1765370912 rel=stylesheet><link href=https://nguyenduyson2005.github.io/fcj-report/css/theme-workshop.css?1765370912 rel=stylesheet><script src=https://nguyenduyson2005.github.io/fcj-report/js/jquery-3.3.1.min.js?1765370912></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,tags:"ams"},svg:{fontCache:"global"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body data-url=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://nguyenduyson2005.github.io/fcj-report/><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://nguyenduyson2005.github.io/fcj-report/js/lunr.min.js?1765370912></script><script type=text/javascript src=https://nguyenduyson2005.github.io/fcj-report/js/auto-complete.js?1765370912></script><script type=text/javascript>var baseurl="https://nguyenduyson2005.github.io/fcj-report//vi"</script><script type=text/javascript src=https://nguyenduyson2005.github.io/fcj-report/js/search.js?1765370912></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-worklog/ title="Nhật ký công việc" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/><b>1. </b>Nhật ký công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Worklog Tuần 1" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.1-week1/><b>1.1. </b>Worklog Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Worklog Tuần 3" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.3-week3/><b>1.3. </b>Worklog Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Worklog Tuần 4" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.4-week4/><b>1.4. </b>Worklog Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Worklog Tuần 5" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.5-week5/><b>1.5. </b>Worklog Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Worklog Tuần 6" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.6-week6/><b>1.6. </b>Worklog Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Worklog Tuần 7" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.7-week7/><b>1.7. </b>Worklog Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Worklog Tuần 8" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.8-week8/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Worklog Tuần 9" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.9-week9/><b>1.9. </b>Worklog Tuần 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Worklog Tuần 10" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.10-week10/><b>1.10 </b>Worklog Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Worklog Tuần 11" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.11-week11/><b>1.11. </b>Worklog Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.12-week12/ title="Worklog Tuần 12" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/1-worklog/1.12-week12/><b>1.12. </b>Worklog Tuần 12
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/2-proposal/ title="Bản đề xuất" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/2-proposal/><b>2. </b>Bản đề xuất
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/ title="Các bài blogs đã dịch" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/3-blogstranslated/><b>3. </b>Các bài blogs đã dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-eventparticipated/ title="Các events đã tham gia" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/4-eventparticipated/><b>4. </b>Các events đã tham gia
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/ title=Workshop class="dd-item
parent"><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.1-workshop-overview/ title="Giới thiệu" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.1-workshop-overview/><b>5.1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.2-data-preparation/ title="Chuẩn Bị Dữ Liệu" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.2-data-preparation/><b>5.2. </b>Chuẩn Bị Dữ Liệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-ml-model/ title="Mô Hình Học Máy" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.3-ml-model/><b>5.3. </b>Mô Hình Học Máy
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-frontback-end/5.4.1-frontend-architecture/ title="Kiến Trúc Frontend" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.1-frontend-architecture/><b>5.4.1 </b>Kiến Trúc Frontend
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/ title="Kiến trúc Lambda" class="dd-item
active"><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/><b>5.4.2 </b>Kiến trúc Lambda
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/5.4.2.2-fix-unicode-error-solution/ title="Sửa lỗi Unicode" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/5.4.2.2-fix-unicode-error-solution/><b>5.4.2.2 </b>Sửa lỗi Unicode
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/5.4.2.1-ai-model-integration/ title="Tích Hợp AI" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/5.4.2.1-ai-model-integration/><b>5.4.2.1 </b>Tích Hợp AI
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/5.4.2.3-lambda-deployment/ title="Triển Khai Lamda" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/5.4.2.3-lambda-deployment/><b>5.4.2.3 </b>Triển Khai Lamda
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/5.5-platform-api/ title="Nền tảng API" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.5-platform-api/><b>5.5. </b>Nền tảng API
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Tự đánh giá" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/6-self-evaluation/><b>6. </b>Tự đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ, đóng góp ý kiến" class=dd-item><a href=https://nguyenduyson2005.github.io/fcj-report/vi/7-feedback/><b>7. </b>Chia sẻ, đóng góp ý kiến
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://nguyenduyson2005.github.io/fcj-report/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/>English</option><option id=vi value=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://nguyenduyson2005.github.io/fcj-report/vi/>Báo cáo thực tập</a> > <a href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/>Workshop</a> > Kiến trúc Lambda</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#tổng-quan>Tổng quan</a></li><li><a href=#kiến-trúc-các-dịch-vụ-aws>Kiến trúc các dịch vụ AWS</a></li><li><a href=#cấu-trúc-thư-mục-storm_prediction>Cấu trúc thư mục storm_prediction/</a></li><li><a href=#cấu-trúc-docker-image>Cấu trúc Docker Image</a><ul><li><a href=#dockerfile>Dockerfile</a></li><li><a href=#các-lớp-image-layers>Các lớp (Image Layers)</a></li></ul></li><li><a href=#các-mô-hình-ai>Các mô hình AI</a><ul><li><a href=#1-mô-hình-tcn-dự-đoán-quỹ-đạo>1. Mô hình TCN (Dự đoán quỹ đạo)</a></li><li><a href=#2-mô-hình-lstm-dự-đoán-tổng-quãng-đường>2. Mô hình LSTM (Dự đoán tổng quãng đường)</a></li></ul></li><li><a href=#luồng-xử-lý-request>Luồng xử lý request</a><ul><li><a href=#1-nhận-request>1. Nhận request</a></li><li><a href=#2-tải-mô-hình-chỉ-lần-gọi-đầu-tiên>2. Tải mô hình (chỉ lần gọi đầu tiên)</a></li><li><a href=#4-dự-đoán-tổng-quãng-đường-lstm>4. Dự đoán tổng quãng đường (LSTM)</a></li><li><a href=#5-dự-đoán-đường-đi-tcn>5. Dự đoán đường đi (TCN)</a></li><li><a href=#6-trả-về-response>6. Trả về response</a></li></ul></li><li><a href=#quy-trình-build--deploy>Quy trình Build & Deploy</a><ul><li><a href=#bước-1-build-docker-image>Bước 1: Build Docker Image</a></li><li><a href=#bước-2-tag-để-push-lên-ecr>Bước 2: Tag để push lên ECR</a></li><li><a href=#bước-3-đăng-nhập-ecr>Bước 3: Đăng nhập ECR</a></li><li><a href=#bước-4-push-image-lên-ecr>Bước 4: Push image lên ECR</a></li><li><a href=#bước-5-cập-nhật-lambda-function>Bước 5: Cập nhật Lambda Function</a></li></ul></li><li><a href=#cấu-hình-lambda>Cấu hình Lambda</a><ul><li><a href=#thiết-lập-function>Thiết lập Function</a></li><li><a href=#biến-môi-trường>Biến môi trường</a></li><li><a href=#function-url>Function URL</a></li><li><a href=#quyền-iam-role>Quyền IAM Role</a></li></ul></li><li><a href=#giám-sát--logs>Giám sát & Logs</a><ul><li><a href=#cloudwatch-logs>CloudWatch Logs</a></li><li><a href=#metrics>Metrics</a></li></ul></li><li><a href=#lỗi-thường-gặp--cách-xử-lý>Lỗi thường gặp & cách xử lý</a><ul><li><a href=#1-unicodedecodeerror-utf-8-codec-cant-decode-byte-0x80>1. UnicodeDecodeError: &lsquo;utf-8&rsquo; codec can&rsquo;t decode byte 0x80</a></li><li><a href=#2-502-bad-gateway>2. 502 Bad Gateway</a></li><li><a href=#3-lstm-fallback>3. LSTM Fallback</a></li><li><a href=#4-ecr-push-403-forbidden>4. ECR Push 403 Forbidden</a></li></ul></li><li><a href=#kiểm-thử>Kiểm thử</a><ul><li><a href=#test-local-nếu-có-thể>Test local (nếu có thể)</a></li><li><a href=#test-trực-tiếp-trên-lambda>Test trực tiếp trên Lambda</a></li><li><a href=#test-bằng-curl>Test bằng cURL</a></li></ul></li><li><a href=#checklist-triển-khai>Checklist triển khai</a></li><li><a href=#ảnh-chụp>Ảnh chụp</a><ul><li></li></ul></li><li><a href=#ecr>ECR</a><ul><li><a href=#kho-lưu-trữ-repository>Kho lưu trữ (Repository)</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Kiến trúc Lambda</h1><h1 id=kiến-trúc-lambda---dịch-vụ-ai-dự-báo-bão>Kiến trúc Lambda - Dịch vụ AI Dự báo Bão</h1><h2 id=tổng-quan>Tổng quan</h2><p>Hàm Lambda là một thành phần quan trọng trong kiến trúc serverless. Chúng đặc biệt hữu ích nhờ chi phí vận hành thấp và khả năng triển khai dễ dàng—những yếu tố rất phù hợp với nền tảng dự đoán bão của nhóm.</p><p>Phần này trình bày chi tiết cách chúng tôi thiết kế và xây dựng kiến trúc Lambda.</p><p>Các hàm Lambda của chúng em chạy mô hình PyTorch để dự đoán quỹ đạo bão và được triển khai thông qua Docker container image.</p><h2 id=kiến-trúc-các-dịch-vụ-aws>Kiến trúc các dịch vụ AWS</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>┌─────────────────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│                   Frontend (Trình duyệt)                    │
</span></span><span style=display:flex><span>└────────────────────────┬────────────────────────────────────┘
</span></span><span style=display:flex><span>                         │ POST /predict
</span></span><span style=display:flex><span>                         ▼
</span></span><span style=display:flex><span>┌─────────────────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│            Lambda Function URL (Công khai)                  │
</span></span><span style=display:flex><span>│  URL: https://vill3povlzqxdyxm7ubldizobu0kdgbi...           │
</span></span><span style=display:flex><span>│  Auth: NONE (không xác thực)                                │
</span></span><span style=display:flex><span>│  Method: POST                                               │
</span></span><span style=display:flex><span>└────────────────────────┬────────────────────────────────────┘
</span></span><span style=display:flex><span>                         │
</span></span><span style=display:flex><span>                         ▼
</span></span><span style=display:flex><span>┌─────────────────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│                       Lambda Function                       │
</span></span><span style=display:flex><span>│  Tên: storm-prediction                                      │
</span></span><span style=display:flex><span>│  Runtime: Python 3.10 (Container)                           │
</span></span><span style=display:flex><span>│  Bộ nhớ: 3008 MB                                            │
</span></span><span style=display:flex><span>│  Timeout: 120 giây                                          │
</span></span><span style=display:flex><span>│  Kiến trúc: x86_64                                          │
</span></span><span style=display:flex><span>└────────────────────────┬────────────────────────────────────┘
</span></span><span style=display:flex><span>                         │
</span></span><span style=display:flex><span>                         ▼
</span></span><span style=display:flex><span>┌─────────────────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│                        ECR Repository                       │
</span></span><span style=display:flex><span>│  Account: 339570693867                                      │
</span></span><span style=display:flex><span>│  Region: ap-southeast-1                                     │
</span></span><span style=display:flex><span>│  Repo: storm-prediction                                     │
</span></span><span style=display:flex><span>│  Image: latest                                              │
</span></span><span style=display:flex><span>│  Size: ~2 GB                                                │
</span></span><span style=display:flex><span>└────────────────────────┬────────────────────────────────────┘
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>┌─────────────────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│                          S3 Buckets                         │
</span></span><span style=display:flex><span>│  1. storm-frontend-hosting-duc-2025                         │
</span></span><span style=display:flex><span>│     - models/lstm_totald_256_4.pt (tùy chọn)                │
</span></span><span style=display:flex><span>│     - predictions/[storm_id]_[timestamp].json               │
</span></span><span style=display:flex><span>│                                                             │
</span></span><span style=display:flex><span>│  2. storm-ai-models (khuyến nghị)                           │
</span></span><span style=display:flex><span>│     - models/lstm_totald_256_4.pt                           │
</span></span><span style=display:flex><span>│     - models/tcn_model.pth (backup)                         │
</span></span><span style=display:flex><span>└─────────────────────────────────────────────────────────────┘
</span></span></code></pre></div><h2 id=cấu-trúc-thư-mục-storm_prediction>Cấu trúc thư mục storm_prediction/</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>storm_prediction/
</span></span><span style=display:flex><span>├── app.py                          # Lambda handler (mã chính)
</span></span><span style=display:flex><span>├── Dockerfile                      # Định nghĩa container
</span></span><span style=display:flex><span>├── requirements.txt                # Thư viện Python phụ thuộc
</span></span><span style=display:flex><span>├── cropping_storm_7304_2l.pth     # Mô hình TCN (đóng kèm trong image)
</span></span><span style=display:flex><span>│
</span></span><span style=display:flex><span>├── DEPLOY_NOW.md                   # Hướng dẫn deploy nhanh
</span></span><span style=display:flex><span>├── DEPLOY_CONSOLE_STEP_BY_STEP.md # Hướng dẫn AWS Console từng bước
</span></span><span style=display:flex><span>├── LAMBDA_DEPLOYMENT_GUIDE.md      # Hướng dẫn triển khai chi tiết
</span></span><span style=display:flex><span>├── AWS_CONSOLE_DEPLOYMENT_GUIDE.md
</span></span><span style=display:flex><span>├── FIX_ECR_PUSH_ERROR.md          # Tài liệu xử lý lỗi ECR
</span></span><span style=display:flex><span>├── FIX_UNICODE_ERROR.md           # Sửa lỗi UnicodeDecodeError
</span></span><span style=display:flex><span>├── FIX_UNICODE_ERROR_SOLUTION.md  # Chi tiết giải pháp
</span></span><span style=display:flex><span>└── REBUILD_AND_DEPLOY.sh          # Script tự động build &amp; deploy
</span></span></code></pre></div><h2 id=cấu-trúc-docker-image>Cấu trúc Docker Image</h2><h3 id=dockerfile>Dockerfile</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> public.ecr.aws/lambda/python:3.10</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Cài đặt dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> requirements.txt .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip3 install -r requirements.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --target <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>LAMBDA_TASK_ROOT<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --extra-index-url https://download.pytorch.org/whl/cpu<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy Lambda handler</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> app.py <span style=color:#e6db74>${</span>LAMBDA_TASK_ROOT<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy mô hình TCN vào thư mục con (tránh nhầm file .pth)</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p <span style=color:#e6db74>${</span>LAMBDA_TASK_ROOT<span style=color:#e6db74>}</span>/models<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> cropping_storm_7304_2l.pth <span style=color:#e6db74>${</span>LAMBDA_TASK_ROOT<span style=color:#e6db74>}</span>/models/<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Đặt handler</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [ <span style=color:#e6db74>&#34;app.handler&#34;</span> ]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=các-lớp-image-layers>Các lớp (Image Layers)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Layer 1: AWS Lambda Python 3.10 base (~500 MB)
</span></span><span style=display:flex><span>Layer 2: PyTorch CPU + dependencies (~1.2 GB)
</span></span><span style=display:flex><span>Layer 3: app.py + mô hình TCN (~300 MB)
</span></span><span style=display:flex><span>─────────────────────────────────────────────
</span></span><span style=display:flex><span>Tổng dung lượng: ~2 GB
</span></span></code></pre></div><h2 id=các-mô-hình-ai>Các mô hình AI</h2><h3 id=1-mô-hình-tcn-dự-đoán-quỹ-đạo>1. Mô hình TCN (Dự đoán quỹ đạo)</h3><p><strong>File</strong>: <code>cropping_storm_7304_2l.pth</code><br><strong>Vị trí</strong>: Bên trong Docker image tại <code>/var/task/models/</code><br><strong>Dung lượng</strong>: ~300 MB<br><strong>Mục đích</strong>: Dự đoán bước tiếp theo (lat, lng) của quỹ đạo bão</p><p><strong>Kiến trúc</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StormTCN</span>(nn<span style=color:#f92672>.</span>Module):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, input_dim<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>, hidden_units<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span>, num_layers<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>tcn <span style=color:#f92672>=</span> TCN(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>head_latlon <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Linear(hidden_units, <span style=color:#ae81ff>2</span>)  <span style=color:#75715e># Dự đoán lat, lng</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>head_aux <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Linear(hidden_units, <span style=color:#ae81ff>2</span>)     <span style=color:#75715e># Dự đoán đặc trưng phụ</span>
</span></span></code></pre></div><p><strong>Input</strong>: <code>[batch, sequence, 4]</code> - (lat, lng, distance, bearing)<br><strong>Output</strong>:</p><ul><li><code>pred_latlon</code>: (lat, lng) kế tiếp</li><li><code>pred_aux</code>: đặc trưng phụ</li></ul><h3 id=2-mô-hình-lstm-dự-đoán-tổng-quãng-đường>2. Mô hình LSTM (Dự đoán tổng quãng đường)</h3><p><strong>File</strong>: <code>lstm_totald_256_4.pt</code><br><strong>Vị trí</strong>: S3 bucket (tải về ở lần chạy đầu tiên)<br><strong>Dung lượng</strong>: ~50 MB<br><strong>Mục đích</strong>: Dự đoán tổng quãng đường bão sẽ di chuyển</p><p><strong>Kiến trúc</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StormLSTM</span>(nn<span style=color:#f92672>.</span>Module):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, input_size<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>, hidden_size<span style=color:#f92672>=</span><span style=color:#ae81ff>256</span>, num_layers<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lstm <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>LSTM(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>fc <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Sequential(
</span></span><span style=display:flex><span>            nn<span style=color:#f92672>.</span>Linear(hidden_size, hidden_size <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>),
</span></span><span style=display:flex><span>            nn<span style=color:#f92672>.</span>ReLU(),
</span></span><span style=display:flex><span>            nn<span style=color:#f92672>.</span>Linear(hidden_size <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>)  <span style=color:#75715e># Dự đoán tổng quãng đường</span>
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><p><strong>Input</strong>: Tổng hợp theo ngày <code>[batch, days, 4]</code> - (day, daily_dist, avg_speed, motion_type)<br><strong>Output</strong>: Tổng quãng đường (km)</p><h2 id=luồng-xử-lý-request>Luồng xử lý request</h2><h3 id=1-nhận-request>1. Nhận request</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>POST /predict
</span></span><span style=display:flex><span>Content-Type: application/json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;history&#34;: [
</span></span><span style=display:flex><span>    {&#34;lat&#34;: 15.0, &#34;lng&#34;: 120.0},
</span></span><span style=display:flex><span>    {&#34;lat&#34;: 15.1, &#34;lng&#34;: 120.1},
</span></span><span style=display:flex><span>    ...  // Tối thiểu 9 điểm
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  &#34;storm_name&#34;: &#34;Test Storm&#34;,
</span></span><span style=display:flex><span>  &#34;storm_id&#34;: &#34;TEST001&#34;  // Tùy chọn
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-tải-mô-hình-chỉ-lần-gọi-đầu-tiên>2. Tải mô hình (chỉ lần gọi đầu tiên)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_models</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>global</span> LSTM_MODEL, TCN_MODEL
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Tải LSTM từ S3 (nếu có)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;/tmp/lstm_model.pt&#39;</span>):
</span></span><span style=display:flex><span>        s3_client<span style=color:#f92672>.</span>download_file(
</span></span><span style=display:flex><span>            MODEL_BUCKET,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;models/lstm_totald_256_4.pt&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;/tmp/lstm_model.pt&#39;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    LSTM_MODEL <span style=color:#f92672>=</span> StormLSTM(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    LSTM_MODEL<span style=color:#f92672>.</span>load_state_dict(torch<span style=color:#f92672>.</span>load(<span style=color:#e6db74>&#39;/tmp/lstm_model.pt&#39;</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Tải TCN từ local (đã có sẵn trong image)</span>
</span></span><span style=display:flex><span>    TCN_MODEL <span style=color:#f92672>=</span> StormTCN(<span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    TCN_MODEL<span style=color:#f92672>.</span>load_state_dict(
</span></span><span style=display:flex><span>        torch<span style=color:#f92672>.</span>load(<span style=color:#e6db74>&#39;/var/task/models/cropping_storm_7304_2l.pth&#39;</span>)
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><h3 id=4-dự-đoán-tổng-quãng-đường-lstm>4. Dự đoán tổng quãng đường (LSTM)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>predict_total_distance</span>(record_tensor):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> LSTM_MODEL <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Dự phòng (fallback): avg_distance * 24 bước</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fallback_distance
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Gom theo ngày (9 điểm/ngày)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Chạy dự đoán bằng LSTM</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> torch<span style=color:#f92672>.</span>no_grad():
</span></span><span style=display:flex><span>        pred <span style=color:#f92672>=</span> LSTM_MODEL(summary_tensor, lengths)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pred<span style=color:#f92672>.</span>item()  <span style=color:#75715e># km</span>
</span></span></code></pre></div><h3 id=5-dự-đoán-đường-đi-tcn>5. Dự đoán đường đi (TCN)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>predict_storm_path</span>(record_tensor, total_distance, history):
</span></span><span style=display:flex><span>    seq <span style=color:#f92672>=</span> record_tensor<span style=color:#f92672>.</span>clone()
</span></span><span style=display:flex><span>    gone_distance <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    predicted_points <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> gone_distance <span style=color:#f92672>&lt;</span> total_distance:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Dự đoán vị trí tiếp theo</span>
</span></span><span style=display:flex><span>        pred_latlon, pred_aux <span style=color:#f92672>=</span> TCN_MODEL(seq)
</span></span><span style=display:flex><span>        new_lat <span style=color:#f92672>=</span> pred_latlon[<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>item()
</span></span><span style=display:flex><span>        new_lng <span style=color:#f92672>=</span> pred_latlon[<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>item()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Tính khoảng cách &amp; hướng di chuyển</span>
</span></span><span style=display:flex><span>        step_distance <span style=color:#f92672>=</span> haversine(last_lat, last_lng, new_lat, new_lng)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Ước lượng tốc độ gió (giảm dần theo thời gian)</span>
</span></span><span style=display:flex><span>        estimated_wind <span style=color:#f92672>=</span> max(avg_wind <span style=color:#f92672>*</span> (<span style=color:#ae81ff>0.98</span> <span style=color:#f92672>**</span> step), <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        predicted_points<span style=color:#f92672>.</span>append({
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;lat&#39;</span>: new_lat,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;lng&#39;</span>: new_lng,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;timestamp&#39;</span>: base_timestamp <span style=color:#f92672>+</span> (step <span style=color:#f92672>*</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>3600</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;windSpeed&#39;</span>: estimated_wind,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;pressure&#39;</span>: <span style=color:#ae81ff>980.0</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;category&#39;</span>: calculate_category(estimated_wind)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e># Cập nhật chuỗi (sliding window)</span>
</span></span><span style=display:flex><span>        seq <span style=color:#f92672>=</span> torch<span style=color:#f92672>.</span>cat([seq[:, <span style=color:#ae81ff>1</span>:, :], next_point<span style=color:#f92672>.</span>unsqueeze(<span style=color:#ae81ff>1</span>)], dim<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        gone_distance <span style=color:#f92672>+=</span> step_distance
</span></span><span style=display:flex><span>        step <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> predicted_points
</span></span></code></pre></div><h3 id=6-trả-về-response>6. Trả về response</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>result <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;storm_id&#39;</span>: storm_id,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;storm_name&#39;</span>: storm_name,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;prediction_time&#39;</span>: datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>isoformat(),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;totalDistance&#39;</span>: <span style=color:#ae81ff>500.5</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;actualDistance&#39;</span>: <span style=color:#ae81ff>520.3</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;lifespan&#39;</span>: <span style=color:#ae81ff>72</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;forecastHours&#39;</span>: <span style=color:#ae81ff>72</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;forecast&#39;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;lat&#39;</span>: <span style=color:#ae81ff>15.1</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;lng&#39;</span>: <span style=color:#ae81ff>106.99</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;timestamp&#39;</span>: <span style=color:#ae81ff>1765015351626</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;windSpeed&#39;</span>: <span style=color:#ae81ff>65</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;pressure&#39;</span>: <span style=color:#ae81ff>980</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;category&#39;</span>: <span style=color:#e6db74>&#39;Typhoon&#39;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;statusCode&#39;</span>: <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;headers&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Content-Type&#39;</span>: <span style=color:#e6db74>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span>: <span style=color:#e6db74>&#39;*&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;body&#39;</span>: json<span style=color:#f92672>.</span>dumps(result)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=quy-trình-build--deploy>Quy trình Build & Deploy</h2><h3 id=bước-1-build-docker-image>Bước 1: Build Docker Image</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd storm_prediction
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker build <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --provenance<span style=color:#f92672>=</span>false <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --platform linux/amd64 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -t storm-prediction-model .
</span></span></code></pre></div><p>Giải thích flags:</p><ul><li><code>--provenance=false</code>: Giảm kích thước image (không kèm metadata build)</li><li><code>--platform linux/amd64</code>: Lambda chỉ hỗ trợ x86_64</li><li><code>-t storm-prediction-model</code>: Tên tag của image</li></ul><h3 id=bước-2-tag-để-push-lên-ecr>Bước 2: Tag để push lên ECR</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker tag storm-prediction-model:latest <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  339570693867.dkr.ecr.ap-southeast-1.amazonaws.com/storm-prediction:latest
</span></span></code></pre></div><h3 id=bước-3-đăng-nhập-ecr>Bước 3: Đăng nhập ECR</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws ecr get-login-password --region ap-southeast-1 | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  docker login --username AWS --password-stdin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  339570693867.dkr.ecr.ap-southeast-1.amazonaws.com
</span></span></code></pre></div><h3 id=bước-4-push-image-lên-ecr>Bước 4: Push image lên ECR</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker push <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  339570693867.dkr.ecr.ap-southeast-1.amazonaws.com/storm-prediction:latest
</span></span></code></pre></div><p>Thời gian: ~5–10 phút (upload ~2GB)</p><h3 id=bước-5-cập-nhật-lambda-function>Bước 5: Cập nhật Lambda Function</h3><p>Trên AWS Console:</p><ol><li>Lambda → storm-prediction</li><li>Tab <strong>Image</strong> → <strong>Deploy new image</strong></li><li>Chọn image <code>latest</code></li><li>Nhấn <strong>Save</strong></li></ol><h2 id=cấu-hình-lambda>Cấu hình Lambda</h2><h3 id=thiết-lập-function>Thiết lập Function</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Name: storm-prediction
</span></span><span style=display:flex><span>Runtime: Container image
</span></span><span style=display:flex><span>Architecture: x86_64
</span></span><span style=display:flex><span>Memory: 3008 MB
</span></span><span style=display:flex><span>Timeout: 120 seconds
</span></span><span style=display:flex><span>Ephemeral storage: 512 MB
</span></span></code></pre></div><h3 id=biến-môi-trường>Biến môi trường</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>MODEL_BUCKET=storm-frontend-hosting-duc-2025
</span></span><span style=display:flex><span>DATA_BUCKET=storm-frontend-hosting-duc-2025
</span></span></code></pre></div><h3 id=function-url>Function URL</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>URL: https://vill3povlzqxdyxm7ubldizobu0kdgbi.lambda-url.ap-southeast-1.on.aws
</span></span><span style=display:flex><span>Auth type: NONE
</span></span><span style=display:flex><span>CORS: Enabled
</span></span><span style=display:flex><span>  - Allow origins: *
</span></span><span style=display:flex><span>  - Allow methods: POST, OPTIONS
</span></span><span style=display:flex><span>  - Allow headers: Content-Type
</span></span></code></pre></div><h3 id=quyền-iam-role>Quyền IAM Role</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logs:CreateLogGroup&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logs:CreateLogStream&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logs:PutLogEvents&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:logs:*:*:*&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetObject&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:PutObject&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:s3:::storm-frontend-hosting-duc-2025/*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:s3:::storm-ai-models/*&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=giám-sát--logs>Giám sát & Logs</h2><h3 id=cloudwatch-logs>CloudWatch Logs</h3><p><strong>Log Group</strong>: <code>/aws/lambda/storm-prediction</code></p><p>Các log quan trọng:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Loading LSTM model...
</span></span><span style=display:flex><span>Downloaded LSTM from S3
</span></span><span style=display:flex><span>LSTM loaded successfully
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Loading TCN model...
</span></span><span style=display:flex><span>Checking: /var/task/models/cropping_storm_7304_2l.pth
</span></span><span style=display:flex><span>Found TCN at /var/task/models/cropping_storm_7304_2l.pth
</span></span><span style=display:flex><span>TCN loaded successfully
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Processing: Test Storm (TEST001)
</span></span><span style=display:flex><span>Input points: 9
</span></span><span style=display:flex><span>Predicted total distance: 500.50 km
</span></span><span style=display:flex><span>Generated 24 predictions (72 hours)
</span></span><span style=display:flex><span>Saved to S3: predictions/TEST001_1733486400.json
</span></span></code></pre></div><h3 id=metrics>Metrics</h3><p>CloudWatch Metrics:</p><ul><li>Invocations</li><li>Duration (trung bình ~5–10 giây)</li><li>Errors</li><li>Throttles</li><li>Memory used (~500–800 MB)</li></ul><h2 id=lỗi-thường-gặp--cách-xử-lý>Lỗi thường gặp & cách xử lý</h2><h3 id=1-unicodedecodeerror-utf-8-codec-cant-decode-byte-0x80>1. UnicodeDecodeError: &lsquo;utf-8&rsquo; codec can&rsquo;t decode byte 0x80</h3><p>Triệu chứng:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0x80 in position 64
</span></span></code></pre></div><p>Nguyên nhân: file model <code>.pth</code> ở thư mục gốc bị Lambda hiểu nhầm như file cấu hình Python</p><p>Cách xử lý: chuyển model vào thư mục con</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> mkdir -p <span style=color:#e6db74>${</span>LAMBDA_TASK_ROOT<span style=color:#e6db74>}</span>/models<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> cropping_storm_7304_2l.pth <span style=color:#e6db74>${</span>LAMBDA_TASK_ROOT<span style=color:#e6db74>}</span>/models/<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=2-502-bad-gateway>2. 502 Bad Gateway</h3><p>Triệu chứng: Frontend nhận lỗi 502</p><p>Nguyên nhân có thể:</p><ul><li>Lambda timeout (quá 120s)</li><li>Lambda crash (hết bộ nhớ)</li><li>Load model thất bại</li></ul><p>Cách xử lý:</p><ol><li>Kiểm tra CloudWatch Logs</li><li>Tăng memory nếu cần</li><li>Tăng timeout nếu cần</li></ol><h3 id=3-lstm-fallback>3. LSTM Fallback</h3><p>Đặc điểm: log có " Using fallback distance"</p><p>Nguyên nhân: chưa có model LSTM trên S3</p><p>Cách xử lý: upload <code>lstm_totald_256_4.pt</code> lên S3</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3 cp lstm_totald_256_4.pt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  s3://storm-frontend-hosting-duc-2025/models/
</span></span></code></pre></div><h3 id=4-ecr-push-403-forbidden>4. ECR Push 403 Forbidden</h3><p>Đặc điểm: <code>403 Forbidden</code> khi push image</p><p>Nguyên nhân có thể:</p><ul><li>Hết hạn đăng nhập ECR</li><li>Sai account ID</li><li>Repo chưa tồn tại</li></ul><p>Cách xử lý:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Đăng nhập lại</span>
</span></span><span style=display:flex><span>aws ecr get-login-password --region ap-southeast-1 | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  docker login --username AWS --password-stdin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  339570693867.dkr.ecr.ap-southeast-1.amazonaws.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Tạo repository nếu cần</span>
</span></span><span style=display:flex><span>aws ecr create-repository <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --repository-name storm-prediction <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --region ap-southeast-1
</span></span></code></pre></div><h2 id=kiểm-thử>Kiểm thử</h2><h3 id=test-local-nếu-có-thể>Test local (nếu có thể)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Chạy local</span>
</span></span><span style=display:flex><span>python app<span style=color:#f92672>.</span>py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test event</span>
</span></span><span style=display:flex><span>test_event <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;history&#34;</span>: [
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.0</span>, <span style=color:#e6db74>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.0</span>},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.1</span>, <span style=color:#e6db74>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.1</span>},
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;storm_name&#34;</span>: <span style=color:#e6db74>&#34;Test Storm&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>result <span style=color:#f92672>=</span> handler(test_event, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>print(result)
</span></span></code></pre></div><h3 id=test-trực-tiếp-trên-lambda>Test trực tiếp trên Lambda</h3><p>Trên AWS Console:</p><ol><li>Lambda → tab Test</li><li>Tạo test event:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;history&#34;</span>: [
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.0</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.0</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.1</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.1</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.2</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.2</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.3</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.3</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.4</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.4</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.5</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.5</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.6</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.6</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.7</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.7</span>},
</span></span><span style=display:flex><span>    {<span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>15.8</span>, <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>120.8</span>}
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;storm_name&#34;</span>: <span style=color:#e6db74>&#34;Test Storm&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>Nhấn <strong>Test</strong></li><li>Kiểm tra response</li></ol><h3 id=test-bằng-curl>Test bằng cURL</h3><p><code>bash curl -X POST \ "https://vill3povlzqxdyxm7ubldizobu0kdgbi.lambda-url.ap-southeast-1.on.aws/predict" \ -H "Content-Type: application/json" \ -d '{ "history": [ {"lat": 15.0, "lng": 120.0}, {"lat": 15.1, "lng": 120.1}, {"lat": 15.2, "lng": 120.2}, {"lat": 15.3, "lng": 120.3}, {"lat": 15.4, "lng": 120.4}, {"lat": 15.5, "lng": 120.5}, {"lat": 15.6, "lng": 120.6}, {"lat": 15.7, "lng": 120.7}, {"lat": 15.8, "lng": 120.8} ], "storm_name": "Test Storm" }'</code></p><h2 id=checklist-triển-khai>Checklist triển khai</h2><ul><li>File model <code>cropping_storm_7304_2l.pth</code> tồn tại</li><li>(Tùy chọn) Upload model LSTM lên S3</li><li>Build Docker image thành công</li><li>Tag image đúng account ID (339570693867)</li><li>Login ECR thành công</li><li>Push image lên ECR</li><li>Update Lambda function với image mới</li><li>Kiểm tra cấu hình Lambda (memory, timeout)</li><li>Test Lambda với test event</li><li>Test qua Function URL bằng cURL</li><li>Test từ frontend</li><li>Kiểm tra CloudWatch Logs</li><li>Xác nhận kết quả dự đoán hiển thị trên bản đồ</li></ul><h2 id=ảnh-chụp>Ảnh chụp</h2><p align=center><img src=https://nguyenduyson2005.github.io/fcj-report/images/5-Workshop/5.4-FB_END/5.4.2-Lambda/image-13.png alt="Picture 1"><br><strong style=font-size:18px>Hình 1</strong></p><h4 id=cấu-hình-configuration>Cấu hình (Configuration)</h4><p align=center><img src=https://nguyenduyson2005.github.io/fcj-report/images/5-Workshop/5.4-FB_END/5.4.2-Lambda/image-14.png alt="Picture 2"><br><strong style=font-size:18px>Hình 2</strong></p><h4 id=biến-môi-trường-environment-variables>Biến môi trường (Environment Variables)</h4><p align=center><img src=https://nguyenduyson2005.github.io/fcj-report/images/5-Workshop/5.4-FB_END/5.4.2-Lambda/image-15.png alt="Picture 3"><br><strong style=font-size:18px>Hình 3</strong></p><h2 id=ecr>ECR</h2><h3 id=kho-lưu-trữ-repository>Kho lưu trữ (Repository)</h3><p align=center><img src=https://nguyenduyson2005.github.io/fcj-report/images/5-Workshop/5.4-FB_END/5.4.2-Lambda/image-16.png alt="Picture 4"><br><strong style=font-size:18px>Hình 4</strong></p><p align=center><img src=https://nguyenduyson2005.github.io/fcj-report/images/5-Workshop/5.4-FB_END/5.4.2-Lambda/image-17.png alt="Picture 5"><br><strong style=font-size:18px>Hình 5</strong></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.1-frontend-architecture/ title="Kiến Trúc Frontend"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://nguyenduyson2005.github.io/fcj-report/vi/5-workshop/5.4-frontback-end/5.4.2-lambda-architecture/5.4.2.2-fix-unicode-error-solution/ title="Sửa lỗi Unicode" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://nguyenduyson2005.github.io/fcj-report/js/clipboard.min.js?1765370912></script><script src=https://nguyenduyson2005.github.io/fcj-report/js/perfect-scrollbar.min.js?1765370912></script><script src=https://nguyenduyson2005.github.io/fcj-report/js/perfect-scrollbar.jquery.min.js?1765370912></script><script src=https://nguyenduyson2005.github.io/fcj-report/js/jquery.sticky.js?1765370912></script><script src=https://nguyenduyson2005.github.io/fcj-report/js/featherlight.min.js?1765370912></script><script src=https://nguyenduyson2005.github.io/fcj-report/js/highlight.pack.js?1765370912></script><script>hljs.initHighlightingOnLoad()</script><script src=https://nguyenduyson2005.github.io/fcj-report/js/modernizr.custom-3.6.0.js?1765370912></script><script src=https://nguyenduyson2005.github.io/fcj-report/js/learn.js?1765370912></script><script src=https://nguyenduyson2005.github.io/fcj-report/js/hugo-learn.js?1765370912></script><link href=https://nguyenduyson2005.github.io/fcj-report/mermaid/mermaid.css?1765370912 rel=stylesheet><script src=https://nguyenduyson2005.github.io/fcj-report/mermaid/mermaid.js?1765370912></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>